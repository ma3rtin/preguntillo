{{#error}}
    <script>alert('{{error}}');</script>
{{/error}}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUkdndYG9gSK35o6qXfqaG1w8i5oj1TGA&callback=initMap&libraries=places"
        async defer></script>

<h2 class="body-title">Registro de Usuario</h2>

<div class="container-form">

    <form class="register-form" action="/usuario/register" method="POST" enctype="multipart/form-data">
        <div class="field-container">
            <div class="input-container">
                <label for="user">Nombre de usuario:</label><br>
                <input type="text" id="user" name="user" required><br><br>

                <label for="name">Nombre completo:</label><br>
                <input type="text" id="name" name="name" required><br><br>

                <label for="email">Correo electrónico:</label><br>
                <input type="email" id="email" name="email" required><br><br>

                <label for="pass">Contraseña:</label><br>
                <input type="password" id="pass" name="pass" required><br><br>

                <label for="pass2">Repetir contraseña:</label><br>
                <input type="password" id="pass2" name="pass2" required><br><br>
            </div>
            <div class="input-container">

                <label for="birthyear">Año de nacimiento:</label><br>
                <input type="number" id="birthyear" name="birthyear" min="1900" max="2024" required><br><br>

                <label for="sexo">Sexo:</label><br>
                <select id="sexo" name="sexo" required>
                    <option value="" disabled selected>Seleccione una opción</option>
                    <option value="Masculino">Masculino</option>
                    <option value="Femenino">Femenino</option>
                    <option value="Prefiero no cargarlo">Prefiero no cargarlo</option>
                </select><br><br>

                <label for="photo">Subir foto:</label><br>
                <input type="file" id="photo" name="photo" accept="image/*" required><br><br>

                <label for="pais">Selecciona un país:</label>
                <select id="pais" name="pais">
                    <option value="">Cargando países...</option>
                </select><br><br>

                <label for="latitude">Ubicación:</label><br>
                <div id="map" style="width: 100%; height: 250px;"></div>
                <input type="hidden" id="latitude" name="latitude">
                <input type="hidden" id="longitude" name="longitude"><br><br>
            </div>
        </div>
        <div>
            <button class="button btn-register" type="submit">Registrarse</button>
            <br><br>
            <a href="/usuario/loginForm">Iniciar sesión</a>
        </div>
    </form>
</div>
<script>
    let map, marker;

    function initMap() {
        const initialLocation = {lat: -34.6037, lng: -58.3816};

        map = new google.maps.Map(document.getElementById("map"), {
            center: initialLocation,
            zoom: 12,
        });
        map.addListener("click", (event) => {
            placeMarker(event.latLng);
        });
    }

    function placeMarker(location) {
        if (marker) {
            marker.setPosition(location);
        } else {
            marker = new google.maps.Marker({
                position: location,
                map: map,
            });
        }

        document.getElementById("latitude").value = location.lat();
        document.getElementById("longitude").value = location.lng();
    }

    fetch('https://restcountries.com/v3.1/all')
            .then(response => response.json())
            .then(data => {
                const countriesDropdown = document.getElementById('pais');
                countriesDropdown.innerHTML = '';
                const sortedData = data.sort((a, b) => {
                    return a.name.common.localeCompare(b.name.common);
                });
                sortedData.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.cca2;
                    option.textContent = country.name.common;
                    countriesDropdown.appendChild(option);
                });
            })
            .catch(error => console.error('Error al cargar los países:', error));
</script>

